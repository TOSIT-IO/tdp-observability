# Copyright 2022 TOSIT.IO
# SPDX-License-Identifier: Apache-2.0

---
# promtail users and group
promtail_user: promtail
promtail_group: hadoop

# promtail version
promtail_release: promtail-2.7.2-linux-amd64
promtail_dist_file: "{{ promtail_release }}.zip"

# promtail installation directory
promtail_root_dir: /opt/tdp_observability
promtail_install_dir: "{{ promtail_root_dir }}/promtail"

# promtail configuration directory
promtail_conf_dir: /etc/promtail

# promtail data directory
promtail_data_dir: /var/lib/promtail

# promtail configuration
loki_server: "{{ groups['loki'][0] | tosit.tdp.access_fqdn(hostvars) }}"
promtail_configuration:
  server:
    http_listen_port: "{{ promtail_web_port }}"
    grpc_listen_port: "{{ promtail_grpc_port }}"
  positions:
    filename: "{{ promtail_data_dir }}/positions.yaml"
  clients:
    - url: "https://{{ loki_server }}:3100/loki/api/v1/push"

promtail_scrape_configs: []

promtail_log_groups:
  hadoop: [ 'hadoop_client' , 'hadoop_master' ]
  hdfs: [ 'hdfs_dn', 'hdfs_httpfs', 'hdfs_jn', 'hdfs_nn' ]
  yarn: [ 'yarn_ats', 'yarn_nm', 'yarn_rm']
  mapred: [ 'mapred_jhs']
  hbase: [ 'hbase_client', 'hbase_master', 'hbase_rest', 'hbase_rs']
  phoenix: [ 'phoenix_queryserver_client', 'phoenix_queryserver_daemon']
  hive: [ 'hive_client', 'hive_ms', 'hive_s2']
  knox: [ 'knox' ]
  ranger: [ 'ranger_admin', 'ranger_solr', 'ranger_kms', 'ranger_usersync']
  spark2: [ 'spark_client', 'spark_hs']
  spark3: ['spark3_client', 'spark3_hs']
  zookeeper: [ 'zk', 'sk_client']

# promtail service start on boot policies
promtail_start_on_boot: false
